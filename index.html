<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ¡åœ’ç”Ÿå­˜æ¼”ç®—æ³• v2.0ï¼šè§£ç¢¼èˆ‡é–ƒé¿</title>
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-purple: #bd00ff;
            --neon-red: #ff003c;
            --neon-green: #00ff94;
            --bg-dark: #050505;
            --panel-bg: #111;
            --text-color: #e0e0e0;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-color);
            font-family: 'Segoe UI', 'PingFang TC', 'Microsoft JhengHei', monospace;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: radial-gradient(circle at center, #1a1a1a 0%, #000 70%);
        }

        #game-container {
            width: 90%;
            max-width: 700px;
            background: var(--panel-bg);
            border: 2px solid var(--neon-blue);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        /* æƒæç·šç‰¹æ•ˆ */
        #game-container::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* é ‚éƒ¨ç‹€æ…‹åˆ— */
        .hud-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
            position: relative;
            z-index: 3;
        }

        .title-label { font-weight: bold; letter-spacing: 1px; color: var(--neon-blue); text-shadow: 0 0 5px var(--neon-blue); }
        
        .mp-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .mp-label { font-family: monospace; color: var(--neon-green); }

        .mp-bar-bg {
            width: 200px;
            height: 16px;
            background: #222;
            border: 1px solid #555;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        #mp-fill {
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, var(--neon-red), var(--neon-green));
            transition: width 0.5s cubic-bezier(0.4, 0.0, 0.2, 1), background 0.5s ease;
        }

        /* é¡¯ç¤ºå€åŸŸ */
        #display-area { min-height: 250px; margin-bottom: 30px; position: relative; z-index: 3; }
        .system-tag { color: var(--neon-blue); font-family: monospace; font-size: 1rem; margin-bottom: 15px; display: flex; align-items: center; }
        .system-tag::before { content: '[ '; color: #555; }
        .system-tag::after { content: ' ]'; color: #555; }
        
        .scene-text { font-size: 1.2rem; line-height: 1.7; color: #fff; margin-bottom: 20px; }
        .scene-text strong { color: var(--neon-purple); }
        
        .consequence { 
            font-size: 1rem; 
            color: #aaa; 
            margin-top: 15px; 
            padding: 10px; 
            border-left: 3px solid var(--neon-green);
            background: rgba(0, 255, 148, 0.05);
        }

        /* æŒ‰éˆ•å€ */
        .btn-grid { display: grid; grid-template-columns: 1fr; gap: 15px; position: relative; z-index: 3; }
        
        button {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid var(--neon-blue);
            color: var(--text-color);
            padding: 16px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            font-size: 1.05rem;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            font-family: monospace;
        }

        button:hover {
            background: rgba(0, 243, 255, 0.15);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.3);
            transform: translateX(5px);
        }

        button.danger { border-color: var(--neon-red); color: var(--neon-red); }
        button.danger:hover { background: rgba(255, 0, 60, 0.15); box-shadow: 0 0 15px rgba(255, 0, 60, 0.3); }
        
        button.menu-btn { border-color: var(--neon-purple); color: var(--neon-purple); text-align: center; font-size: 1.2rem; font-weight: bold;}
        button.menu-btn:hover { background: rgba(189, 0, 255, 0.15); box-shadow: 0 0 15px rgba(189, 0, 255, 0.3); transform: scale(1.02); }

        /* æˆå°±åˆ—è¡¨ */
        .achievement-list { margin-top: 20px; text-align: left; }
        .achievement-item { display: inline-block; background: rgba(0, 255, 148, 0.1); border: 1px solid var(--neon-green); padding: 5px 10px; border-radius: 4px; margin: 5px; font-size: 0.9rem; color: var(--neon-green); }
        .counselor-note { margin-top: 20px; font-size: 0.95rem; color: #aaa; border-top: 1px dashed #555; padding-top: 15px; font-style: italic; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="hud-bar">
        <div class="title-label">PROTOCOL: SOCIAL SURVIVAL</div>
        <div class="mp-container">
            <span class="mp-label">MENTAL POWER (MP): <span id="mp-value">100</span>%</span>
            <div class="mp-bar-bg"><div id="mp-fill"></div></div>
        </div>
    </div>

    <div id="display-area">
        <div class="system-tag" id="sys-tag">SYSTEM READY</div>
        <div class="scene-text" id="scene-text">
            æ­¡è¿é€²å…¥ç¤¾äº¤æ¼”ç®—æ³•æ¨¡æ“¬ç³»çµ± v2.0ã€‚<br>è«‹é¸æ“‡ä»Šæ—¥è¦è¼‰å…¥çš„è¨“ç·´æ¨¡çµ„ï¼š
        </div>
        <div class="consequence" id="cons-text" style="display:none;"></div>
        <div id="achievement-area" style="display:none;"></div>
    </div>

    <div class="btn-grid" id="action-btns">
        <button class="menu-btn" onclick="startHallwayScenario()">è¼‰å…¥æ¨¡çµ„ Aï¼šã€èµ°å»Šç”Ÿå­˜æˆ°ã€‘</button>
        <button class="menu-btn" onclick="startLunchScenario()">è¼‰å…¥æ¨¡çµ„ Bï¼šã€åˆé¤å¹³è¡¡æˆ°ã€‘</button>
    </div>
</div>

<script>
    let mp = 100;
    let lunchFlags = { stealthWash: false, energySaved: false, stoic: false }; // ç”¨æ–¼è¿½è¹¤åˆé¤æˆå°±
    
    const sysTag = document.getElementById('sys-tag');
    const sceneText = document.getElementById('scene-text');
    const consText = document.getElementById('cons-text');
    const btnGrid = document.getElementById('action-btns');
    const mpValue = document.getElementById('mp-value');
    const mpFill = document.getElementById('mp-fill');
    const achievementArea = document.getElementById('achievement-area');

    function updateMP(change) {
        mp = Math.min(100, Math.max(0, mp + change));
        mpValue.innerText = mp;
        mpFill.style.width = mp + '%';
        
        if(mp > 60) mpFill.style.background = 'linear-gradient(90deg, var(--neon-red), var(--neon-green))';
        else if(mp > 30) mpFill.style.background = 'linear-gradient(90deg, var(--neon-red), #bd00ff)';
        else mpFill.style.background = 'var(--neon-red)';
    }

    function setScene(tag, scene, cons = "") {
        sysTag.innerText = "SYSTEM MSG: " + tag;
        sceneText.innerHTML = scene;
        if (cons) {
            consText.style.display = "block";
            consText.innerHTML = cons;
        } else {
            consText.style.display = "none";
        }
        achievementArea.style.display = "none";
    }

    function renderButtons(options) {
        btnGrid.innerHTML = '';
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.innerHTML = opt.text;
            if(opt.danger) btn.className = 'danger';
            if(opt.menu) btn.className = 'menu-btn';
            btn.onclick = opt.action;
            btnGrid.appendChild(btn);
        });
    }
    
    function resetGame() {
        mp = 100;
        updateMP(0);
        lunchFlags = { stealthWash: false, energySaved: false, stoic: false };
        setScene("SYSTEM READY", "æ­¡è¿é€²å…¥ç¤¾äº¤æ¼”ç®—æ³•æ¨¡æ“¬ç³»çµ± v2.0ã€‚<br>è«‹é¸æ“‡ä»Šæ—¥è¦è¼‰å…¥çš„è¨“ç·´æ¨¡çµ„ï¼š");
        renderButtons([
            { text: "è¼‰å…¥æ¨¡çµ„ Aï¼šã€èµ°å»Šç”Ÿå­˜æˆ°ã€‘", menu: true, action: () => startHallwayScenario() },
            { text: "è¼‰å…¥æ¨¡çµ„ Bï¼šã€åˆé¤å¹³è¡¡æˆ°ã€‘", menu: true, action: () => startLunchScenario() }
        ]);
    }

    // ==========================================
    // æ¨¡çµ„ Aï¼šèµ°å»Šç”Ÿå­˜æˆ° (åŸå§‹å…§å®¹)
    // ==========================================
    function startHallwayScenario() {
        updateMP(0);
        setScene("åµæ¸¬åˆ°ç›®æ¨™ç‰© (è·é›¢ 10 å…¬å°º)", "å ´æ™¯ï¼šçª„çª„çš„èµ°å»Šï¼Œå‰æ–¹å‡ºç¾ã€Œå™ªéŸ³é¾æ²é¢¨ã€åŠå…¶æœ‹å‹åœˆã€‚<br>ç›®æ¨™ï¼šç©¿éèµ°å»Šï¼ŒMP ä¿æŒåœ¨ 90 ä»¥ä¸Šã€‚", "");
        renderButtons([
            { text: "ã€æˆ°è¡“ç¹é“ã€‘è½‰èº«èµ°æ“å ´æˆ–å¦ä¸€å´æ¨“æ¢¯", action: () => hallwayA('reroute') },
            { text: "ã€å£è™æ¨¡å¼ã€‘è‚©è†€è²¼ç‰†ï¼Œç¸®å°èº«é«”å¯¬åº¦", action: () => hallwayA('wall') },
            { text: "ã€å¾…æ©Ÿé˜²ç¦¦ã€‘å‡è£çœ‹å…¬ä½ˆæ¬„ï¼Œç­‰å°æ–¹é€šé", action: () => hallwayA('standby') }
        ]);
    }

    function hallwayA(choice) {
        if(choice === 'reroute') {
            setScene("åŸ·è¡Œï¼šTactical Reroute", "å¤šèŠ±äº† 2 åˆ†é˜ï¼Œä½†ç¢°æ’æ©Ÿç‡å®Œç¾é™ç‚º 0%ã€‚", "æ¼”ç®—çµæœï¼šMP æè€— 0ã€‚");
        } else if(choice === 'wall') {
            updateMP(-5);
            setScene("åŸ·è¡Œï¼šWall-Hugger Mode", "ä½ å°ˆæ³¨æ§åˆ¶è‚Œè‚‰ç¸®å°äº†ç¢°æ’é¢ç©ï¼ŒæˆåŠŸé–ƒé¿ã€‚", "æ¼”ç®—çµæœï¼šMP -5 (ç²¾ç¥å°ˆæ³¨æ¶ˆè€—)ã€‚");
        } else {
            updateMP(5);
            setScene("åŸ·è¡Œï¼šStand-by Protection", "å°æ–¹åµé¬§åœ°èµ°éå»äº†ï¼Œè·¯å¾‘ç¾åœ¨éå¸¸é€šæš¢ã€‚", "æ¼”ç®—çµæœï¼šMP æ¢å¾© +5 (ç²å¾—å–˜æ¯)ã€‚");
        }
        setTimeout(() => hallwayB_Trigger(), 2000);
    }

    function hallwayB_Trigger() {
        setScene("è­¦å‘Šï¼šçªç™¼è¡çªäº‹ä»¶", "å°æ–¹çªç„¶è½‰å‘å°ä½ å¤§å–Šï¼šã€Œå–‚ï¼æ“‹è·¯å•¦ï¼ã€<br>è«‹é¸æ“‡ä½ çš„èªè¨€å›å ±æŒ‡ä»¤ï¼š");
        renderButtons([
            { text: "ã€é‚è¼¯ç³¾æ­£ã€‘ã€Œå…¬å…±ç©ºé–“ä½”æœ‰ç‡æœªé” 30%...ã€", action: () => hallwayB('logic') },
            { text: "ã€è·³é‡å”±ç‰‡æ³•ã€‘èªæ°£å¹³æ·¡å¦‚æ©Ÿå™¨äººï¼šã€Œå–”ï¼Œæ˜¯å–”ã€‚ã€", action: () => hallwayB('broken') },
            { text: "ã€é“æ­‰å½è£ã€‘ä¸çœ‹å°æ–¹ï¼Œä½é ­èªªã€Œå€Ÿéã€å¿«é€Ÿé–ƒé–‹", action: () => hallwayB('camo') },
            { text: "ã€åŸ·è¡Œæ¥µç«¯è¨ˆç•«ã€‘è§£é™¤é™åˆ¶é€²è¡Œåæ“Š", danger: true, action: () => hallwayD_Crash() }
        ]);
    }

    function hallwayB(choice) {
        if(choice === 'logic') {
            updateMP(-30);
            setScene("éŒ¯èª¤ï¼šé‚è¼¯æ¼”ç®—æ³•å¤±æ•ˆ", "å°æ‰‹è¦ºå¾—ä½ åœ¨æŒ‘é‡ï¼Œç™¼å‹•ã€Œä¼¶ç‰™ä¿é½’ã€é€£æ“Šã€‚ä½ é™·å…¥äº†ç„¡æ­¢ç›¡çš„è¾¯è«–æ¼©æ¸¦ã€‚", "çµæœï¼šMP -30ï¼Œç³»çµ±éç†±ã€‚");
        } else if(choice === 'broken') {
            updateMP(-5);
            setScene("é˜²ç¦¦æˆåŠŸï¼šå°æ‰‹å¤±å»èˆˆè¶£", "å°æ–¹è¦ºå¾—ä½ åƒçŸ³é ­ä¸€æ¨£ç„¡èŠï¼Œç¿»äº†å€‹ç™½çœ¼é›¢é–‹ã€‚", "çµæœï¼šMP -5ï¼Œæœ‰æ•ˆé™ä½æå®³ã€‚");
        } else {
            updateMP(-10);
            setScene("éš±èº«æˆåŠŸï¼šè„«é›¢æˆ°å ´", "é›–ç„¶æ„Ÿè¦ºæœ‰é»å§”å±ˆï¼Œä½†é€™æ˜¯æœ€å¿«çµæŸæˆ°é¬¥çš„æ–¹å¼ã€‚", "çµæœï¼šMP -10ï¼Œå¿«é€Ÿæ­¢æã€‚");
        }
        setTimeout(() => hallwayC_Trigger(), 2500);
    }

    function hallwayC_Trigger() {
        setScene("æ¥µé™ç”Ÿå­˜æ¨¡å¼ï¼šç‰©ç†æ¥è§¸é¢¨éšª", "å°æ–¹åœ¨æ“¦èº«è€Œéæ™‚æ•…æ„ä¼¸æ‰‹æ¨äº†ä½ ä¸€æŠŠã€‚é€™æ˜¯ä¸å‹å–„çš„ç‰©ç†è¨Šè™Ÿã€‚è«‹åŸ·è¡Œç·Šæ€¥ SOPï¼š");
        renderButtons([
            { text: "ã€ç·Šæ€¥éœé»˜ã€‘ä¸é‚„æ‰‹ã€ä¸å°è¦–ï¼Œå•Ÿå‹•å‘¼å¸æ³•", action: () => hallwayC('silence') },
            { text: "ã€å¤§è…¦å­˜æª”ã€‘é»˜å¿µæ™‚é–“åœ°é»ï¼Œå°‡æ†¤æ€’è½‰åŒ–ç‚ºè’è­‰è¨˜æ†¶", action: () => hallwayC('log') },
            { text: "ã€å¬å–šç¥ç¸ã€‘ç›´æ¥èµ°å‘æœ€è¿‘çš„è¾¦å…¬å®¤æˆ–ç›£è¦–å™¨ä¸‹", action: () => hallwayC('summon') }
        ]);
    }

    function hallwayC(choice) {
        let msg = "";
        if(choice === 'silence') { updateMP(0); msg = "æˆåŠŸé¿å…äº‹æ…‹å‡ç´šï¼Œä¿æŒäº†ã€Œç„¡è¾œå—å®³è€…ã€çš„å½±åƒæ•¸æ“šã€‚"; }
        else if(choice === 'log') { updateMP(10); msg = "å°‡æƒ…ç·’è½‰åŒ–ç‚ºæ•¸æ“šä»»å‹™ï¼ŒMP ç©©å®šåº¦æå‡ã€‚"; }
        else { updateMP(5); msg = "å¼·åˆ¶ä¸­æ–·äº†å°æ–¹çš„æ”»æ“Šæµç¨‹ï¼Œå±æ©Ÿè§£é™¤ã€‚"; }
        
        setScene("ä»»å‹™çµç®—", "ä½ æˆåŠŸæŠµé”äº†ç›®çš„åœ°ã€‚", msg);
        setTimeout(() => showEnding(), 2000);
    }

    function hallwayD_Crash() {
        updateMP(-100);
        setScene("ï¼ï¼ï¼ç³»çµ±åš´é‡å´©æ½°ï¼ï¼ï¼", "åŸ·è¡Œæ¥µç«¯è¨ˆç•«ä¸­...<br>ğŸ” åµæ¸¬åˆ°ï¼šç›£è¦–å™¨ã€é„°è¿‘è­‰äººã€DNA æ¡é›†æŠ€è¡“ã€‚<br>ğŸ“‰ é æœŸæ¼”ç®—çµæœï¼šå­¸ç±æ°¸ä¹…è¨»éŠ·ã€ç›£ç„åœ°åœ–è§£é–ã€çˆ¶æ¯ MP æ­¸é›¶ã€‚", "ç³»çµ±è©•åƒ¹ï¼šé€™æ˜¯ä¸€å€‹ã€Œæœ€é«˜æˆæœ¬ã€æœ€ä½æ•ˆç›Šã€çš„å¤±æ•—ç­–ç•¥ã€‚");
        renderButtons([{ text: "âš ï¸ å¼·åˆ¶é‡å•Ÿç³»çµ± (è®€å–å­˜æª”)", action: () => resetGame() }]);
    }

    // ==========================================
    // æ¨¡çµ„ Bï¼šåˆé¤å¹³è¡¡æˆ° (æ–°å…§å®¹)
    // ==========================================
    function startLunchScenario() {
        updateMP(0);
        setScene("è¼‰å…¥å ´æ™¯ï¼šæ··äº‚çš„åˆé¤æ™‚é–“", "ç’°å¢ƒåƒæ•¸ï¼šæ•™å®¤å……æ»¿é£¯èœå‘³ã€é«˜åˆ†è²å™ªéŸ³ã€åŒå­¸æ‹¿è‘—é¤å…·ç„¡åºç§»å‹•ã€‚<br>ä»»å‹™ç›®æ¨™ï¼šå®Œæˆé€²é£Ÿèˆ‡æ¸…æ½”ï¼Œå°‡ MP è€—æé™è‡³æœ€ä½ã€‚");
        setTimeout(() => lunchA_Queue(), 2500);
    }

    function lunchA_Queue() {
        setScene("éšæ®µä¸€ï¼šç››é£¯æ’éšŠ", "å¤§å®¶èµ·èº«é ˜é¤ï¼Œã€Œå™ªéŸ³é¾æ²é¢¨ã€å°±åœ¨ä½ é™„è¿‘ã€‚æ„Ÿå®˜è­¦æˆ’å€å—åˆ°å¨è„…ã€‚");
        renderButtons([
            { text: "ã€ç·©è¡ç©ºé–“æ³•ã€‘æ•…æ„èˆ‡å‰æ–¹ç•™å‡º 1.5 å€‹æ‰‹è‡‚è·é›¢", action: () => lunchB_Eating('buffer') },
            { text: "ã€æœ€å¾Œé ˜é¤ç­–ç•¥ã€‘ç­‰å¤§éƒ¨éšŠéƒ½åå¥½å¾Œï¼Œå†èµ·èº«é ˜é¤", action: () => lunchB_Eating('late') }
        ]);
    }

    function lunchB_Eating(queueStrategy) {
        let cons = "";
        if(queueStrategy === 'buffer') {
            updateMP(5);
            cons = "é›–ç„¶è¢«å¾Œé¢çš„äººå‚¬ä¿ƒï¼Œä½†æˆåŠŸç¢ºä¿äº†å‰æ–¹ç©ºé–“ï¼Œæ¸›å°‘äº†æ„å¤–è‚¢é«”æ¥è§¸ã€‚MP +5ã€‚";
        } else {
            updateMP(10);
            cons = "èœè‰²å¯èƒ½å°‘äº†é»ï¼Œä½†é ˜é¤è·¯å¾‘å®Œå…¨æ¸…ç©ºã€‚è¡çªæ©Ÿç‡é™ç‚º 0%ã€‚MP +10ã€‚";
        }
        setScene("éšæ®µäºŒï¼šç”¨é¤éç¨‹ (åŸ·è¡Œä¸­)", "å¥¹ç¾åœ¨åœ¨éš”å£æ¡Œå¤§è²èªªç¬‘ï¼Œä½ æ„Ÿåˆ°è½è¦ºéè¼‰ã€‚è«‹å•Ÿå‹•æ„Ÿå®˜é˜²ç¦¦ï¼š", cons);
        
        renderButtons([
            { text: "ã€è¦–è¦ºéš§é“ã€‘å°ˆæ³¨è§€å¯Ÿç±³é£¯ç´‹ç†ï¼Œé€²è¡Œã€Œé£Ÿç‰©åˆ†æå¯¦é©—ã€", action: () => lunchC_Washing('visual') },
            { text: "ã€è½è¦ºè­·ç›¾ã€‘å¿ƒè£¡é»˜å“¼å–œæ­¡çš„æ¨‚æ›²ï¼Œå°‡å¥¹çš„è²éŸ³éæ¿¾ç‚ºèƒŒæ™¯é›œè¨Š", action: () => lunchC_Washing('sonic') },
            { text: "ã€å®‰éœæ’¤é›¢ã€‘(MPä¸è¶³æ™‚) ç«¯é¤ç›¤æ›åˆ°è§’è½ä½ç½®", action: () => lunchC_Washing('retreat') }
        ]);
    }

    function lunchC_Washing(eatStrategy) {
        if(eatStrategy === 'retreat') {
            updateMP(5);
            lunchFlags.energySaved = true;
        }

        setScene("éšæ®µä¸‰ï¼šç‹¹è·¯ç›¸é€¢å°æŠ—æˆ°", "ä¾†åˆ°æ´—æ‰‹å°ï¼Œç™¼ç¾å¥¹æ­£åœ¨é‚£è£¡ï¼Œé€™æ˜¯é«˜é¢¨éšªäº’å‹•ç†±é»ã€‚");
        renderButtons([
            { text: "ã€æˆ°è¡“æ’¤é€€ã€‘è½‰èº«å›åº§ä½æ•´ç†æŠ½å±œï¼Œ3 åˆ†é˜å¾Œå†ä¾†", action: () => finishLunch('retake') },
            { text: "ã€ç„¡è¡¨æƒ…æ¸…æ½”ã€‘ç¡¬è‘—é ­çš®å»æ´—ï¼Œå‹•ä½œåŠ é€Ÿï¼Œçœ¼ç›ç›¯è‘—æ°´æµ", action: () => lunchC_Conflict() }
        ]);
    }
    
    function lunchC_Conflict() {
        setScene("è­¦å‘Šï¼šé­å—æ”»æ“Š", "å¥¹æ•…æ„ç”©å‹•æ‰‹ä¸Šçš„æ°´ï¼Œæ°´èŠ±å™´åˆ°äº†ä½ çš„è‡‰ä¸Šå’Œåˆ¶æœä¸Šï¼ç³»çµ±åµæ¸¬åˆ°æ€’æ°£å€¼é£†å‡ã€‚");
        renderButtons([
            { text: "ã€éŒ¯èª¤åæ‡‰ã€‘å¤§è²æŒ‡è²¬å¥¹ï¼šã€Œå¦³åœ¨å¹¹ä»€éº¼ï¼ã€", danger: true, action: () => lunch_BadEnd() },
            { text: "ã€H2O ç†è«–ã€‘æ“¦ä¹¾æ°´ï¼Œå¿ƒæƒ³ï¼šã€Œé€™åªæ˜¯æ¶²é«” H2Oï¼Œä¸å…·å‚™æ”»æ“ŠåŠ›ã€‚ã€", action: () => finishLunch('stoic') },
            { text: "ã€å¼·åˆ¶ç³»çµ±é‡å•Ÿã€‘å–ä¸€å£å†°æ°´å†·éœå–‰åš¨ï¼Œç›´æ¥é›¢é–‹ç¾å ´å»æ‰¾è€å¸«", action: () => finishLunch('reboot') }
        ]);
    }
    
    function lunch_BadEnd() {
        updateMP(-50);
        setScene("æ¼”ç®—æ³•å¤±æ•—ï¼šå¼•ç™¼é¨·å‹•", "ä½ çš„æŒ‡è²¬å¼•ç™¼äº†å¥¹æ›´å¤§çš„å›æ“Šèˆ‡å˜²ç¬‘ï¼Œåˆé¤æ™‚é–“åœ¨æ··äº‚èˆ‡é«˜åˆ†è²çˆ­åµä¸­çµæŸã€‚", "çµæœï¼šMP å¤§å¹…æè€—ï¼Œä¸‹åˆèª²ç¨‹å°‡é›£ä»¥å°ˆæ³¨ã€‚");
        renderButtons([{ text: "é‡æ–°è¼‰å…¥æ¨¡çµ„", action: () => startLunchScenario() }]);
    }

    function finishLunch(washStrategy) {
        let cons = "";
        if(washStrategy === 'retake') {
            cons = "æœ€é«˜éšçš„ç”Ÿå­˜æŠ€è¡“ã€‚å¤šèµ°äº†å¹¾æ­¥è·¯ï¼Œä½†æˆåŠŸé¿é–‹äº†æœ€å±éšªçš„ç‰©ç†ç¢°æ’é¢¨éšªã€‚";
            lunchFlags.stealthWash = true;
        } else if (washStrategy === 'stoic') {
            updateMP(5);
            cons = "ä½ çš„ç„¡åæ‡‰è®“å¥¹è¦ºå¾—ç„¡è¶£ã€‚ä½ æˆåŠŸå®ˆä½äº†æƒ…ç·’é‚Šç•Œã€‚";
            lunchFlags.stoic = true;
        } else if (washStrategy === 'reboot') {
            cons = "ä½ æˆåŠŸåœ¨ç³»çµ±éç†±å‰é€²è¡Œäº†å¼·åˆ¶å†·å»ï¼Œä¸¦å°‹æ±‚äº†å¤–éƒ¨å”åŠ©ã€‚";
        }
        
        setScene("åˆé¤ä»»å‹™çµç®—", "ä½ å®Œæˆäº†é€²é£Ÿèˆ‡æ¸…æ½”ä»»å‹™ã€‚", cons);
        setTimeout(() => showLunchEnding(), 2500);
    }

    // ==========================================
    // é€šç”¨çµç®—ç³»çµ±
    // ==========================================
    function showEnding() {
        let rank = mp >= 90 ? "S (ç¤¾äº¤å¤§å¸«)" : (mp >= 70 ? "A (å†·éœè™•ç†è€…)" : "B (èƒ½é‡è€—æè€…)");
        setScene("æ¨¡æ“¬çµæŸï¼šæ•¸æ“šå ±å‘Š", `æœ€çµ‚ MP å‰©é¤˜ï¼š${mp} / 100 <br>ç³»çµ±è©•ç­‰ï¼š<span style="color:var(--neon-purple)">${rank}</span>`, "å»ºè­°ï¼šå°‡ä»Šæ—¥æˆåŠŸä¿ç•™çš„ç²¾ç¥èƒ½é‡ï¼ŒæŠ•å…¥ä½ å–œæ­¡çš„ç ”ç©¶é …ç›®ä¸­ã€‚");
        renderButtons([{ text: "è¿”å›ä¸»é¸å–®", menu: true, action: () => resetGame() }]);
    }

    function showLunchEnding() {
        let achievementsHtml = "";
        if(lunchFlags.energySaved) achievementsHtml += '<span class="achievement-item">ğŸ† çœé›»å¤§å¸« (æˆåŠŸæ›ä½é¿éšª)</span>';
        if(lunchFlags.stealthWash) achievementsHtml += '<span class="achievement-item">ğŸ‘» é€æ˜äºº (å®Œç¾è¿´é¿æ´—æ‰‹å°è¡çª)</span>';
        if(lunchFlags.stoic) achievementsHtml += '<span class="achievement-item">ğŸ—¿ å …æ¯…é˜²ç¦¦ (è¦–æŒ‘é‡ç‚ºç„¡ç‰©)</span>';
        if(mp >= 80) achievementsHtml += '<span class="achievement-item">ğŸ± ç‡Ÿé¤Šå°ˆå®¶ (é«˜ MP å®Œæˆç”¨é¤)</span>';

        if(achievementsHtml === "") achievementsHtml = '<span class="achievement-item" style="color:#aaa; border-color:#555;">æœ¬æ¬¡æœªç²å¾—ç‰¹æ®Šæˆå°±</span>';

        achievementArea.innerHTML = '<div style="margin-bottom:10px; color:var(--neon-green);">ã€ æœ¬æ¬¡æˆå°±è§£é– ã€‘</div>' + achievementsHtml;
        achievementArea.innerHTML += `
            <div class="counselor-note">
                <strong>[ è¼”å°å®¤è¨Šæ¯æ‘˜è¦ ]</strong><br>
                åˆé¤æ™‚é–“æ˜¯ä½ çš„ã€Œèƒ½é‡è£œçµ¦ç«™ã€ã€‚é‚£å€‹å¥³ç”Ÿå°±åƒä¸€éš»æƒ³å·ä½ é£¯åƒçš„çƒé´‰ã€‚å¦‚æœä½ å»è¿½çƒé´‰ï¼Œé£¯å°±æœƒæ¶¼äº†ã€‚ä¸ç®¡å¥¹æ€éº¼å«ï¼Œå®ˆä½ä½ çš„é£¯ã€å®ˆä½ä½ çš„å¿ƒæƒ…ï¼Œä½ å°±è´äº†ã€‚
            </div>
        `;
        achievementArea.style.display = "block";

        setScene("åˆé¤ä»»å‹™å®Œæˆï¼šçµç®—å ±å‘Š", `æœ€çµ‚ MP å‰©é¤˜ï¼š${mp} / 100`);
        consText.style.display = "none"; // éš±è—é€šç”¨å¾Œæœæ¬„ä½ï¼Œä½¿ç”¨å°ˆå±¬æˆå°±å€
        
        renderButtons([{ text: "è¿”å›ä¸»é¸å–®", menu: true, action: () => resetGame() }]);
    }

</script>
</body>
</html>